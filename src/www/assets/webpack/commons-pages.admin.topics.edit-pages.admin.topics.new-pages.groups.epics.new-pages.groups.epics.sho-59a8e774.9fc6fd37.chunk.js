(this.webpackJsonp=this.webpackJsonp||[]).push([[11],{Gapp:function(t,e,n){"use strict";n.d(e,"b",(function(){return m})),n.d(e,"a",(function(){return v})),n.d(e,"c",(function(){return x}));n("AfGZ"),n("XmK6");var o=n("6oy4"),i=n.n(o),r=n("79X9"),s=n("oj/M");const a="[{text}](url)",l=/^(?<indent>\s*)(?<leader>((?<isOl>[*+-])|(?<isUl>\d+\.))( \[([x ])\])?\s)(?<content>.)?/;function c(t,e){return`${t}\n${e}\n${t}`}function u(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=t.substring(0,e.selectionStart);return n&&(o=o.trim()),(o=o.split("\n"))[o.length-1]}function d(t){return{start:{row:(e=t.getSelection()).startLineNumber,column:e.startColumn},end:{row:e.endLineNumber,column:e.endColumn}};var e}function f(t){let e,n,o,i,{textArea:r,text:l,tag:f,cursorOffset:h,blockTag:p,selected:g="",wrap:m,select:v,editor:x}=t,w=!1,b=!1,S=!1;if(g=g.toString(),x){const t=d(x);e=t.start,n=t.end}if(f===a&&URL)try{new URL(g),f="[text]({text})",v="text"}catch(t){}0===g.indexOf("\n")&&(b=!0,g=g.replace(/\n+/,"")),r?r.selectionEnd-r.selectionStart>g.replace(/\n$/,"").length&&(w=!0,g=g.replace(/\n$/,"")):x&&e.row!==n.row&&(w=!0,g=g.replace(/\n$/,""));const C=g.split("\n");x&&!m?(o=x.getValue().split("\n")[e.row],/^\s*$/.test(o)&&(S=!0)):r&&!m&&(o=r.value.substr(0,r.selectionStart).lastIndexOf("\n"),/^\s*$/.test(r.value.substring(o,r.selectionStart))&&(S=!0));const k=r&&0===r.selectionStart||x&&0===e.column&&0===e.row,y=m||S||k?"":"\n";return i=C.length>1&&(!m||null!=p&&""!==p)?null!=p&&""!==p?x?function(t,e,n,o){const i=t.split("\n"),r=d(o);if(i[r.start.row-1]===e&&i[r.end.row+1]===e){if(null!==e){const t=i[r.end.row+1],e=new Range(i[r.start.row-1],0,r.end.row+1,t.length);o.getSelection().setSelectionRange(e)}return n}return c(e,n)}(l,p,g,x):function(t,e,n,o){return u(t,e)===n&&function(t,e){return t.substring(e.selectionEnd).trim().split("\n")[0]}(t,e)===n?(null!=n&&(e.selectionStart=e.selectionStart-(n.length+1),e.selectionEnd=e.selectionEnd+(n.length+1)),o):c(n,o)}(l,r,p,g):C.map((function(t){return f.indexOf("{text}")>-1?f.replace("{text}",t):0===t.indexOf(f)?String(t.replace(f,"")):String(f)+t})).join("\n"):f.indexOf("{text}")>-1?f.replace("{text}",(function(){return g.replace(/\\n/g,"\n").replace(/%br/g,"\\n")})):String(y)+f+g+(m?f:""),b&&(i=`\n${i}`),w&&(i+="\n"),x?x.replaceSelectedText(i,v):Object(s.s)(r,i),function(t){let e,{textArea:n,tag:o,cursorOffset:i,positionBetweenTags:r,removedLastNewLine:s,select:a,editor:l,editorSelectionStart:c,editorSelectionEnd:u}=t;if(!n||n.setSelectionRange){if(a&&a.length>0){if(n){const t=n.selectionStart-(o.length-o.indexOf(a)),e=t+a.length;return n.setSelectionRange(t,e)}if(l)return void l.selectWithinSelection(a,o)}if(n){if(n.selectionStart===n.selectionEnd)return e=r?n.selectionStart-o.length:n.selectionStart,s&&(e-=1),i&&(e-=i),n.setSelectionRange(e,e)}else l&&c.row===u.row&&r&&l.moveCursor(-1*o.length)}}({textArea:r,tag:f.replace("{text}",g),cursorOffset:h,positionBetweenTags:m&&0===g.length,removedLastNewLine:w,select:v,editor:x,editorSelectionStart:e,editorSelectionEnd:n})}function h(t){let{textArea:e,tag:n,cursorOffset:o,blockTag:r,wrap:s,select:a,tagContent:l}=t;const c=i()(e);e=c.get(0);const u=c.val(),d=function(t,e){return t.substring(e.selectionStart,e.selectionEnd)}(u,e)||l;return c.focus(),f({textArea:e,text:u,tag:n,cursorOffset:o,blockTag:r,selected:d,wrap:s,select:a})}function p(t){!function(t,e){var n;if(null===(n=gon.features)||void 0===n||!n.markdownContinueLists)return;if("Enter"!==t.key)return;if(t.altKey||t.ctrlKey||t.metaKey||t.shiftKey)return;if(e.selectionStart!==e.selectionEnd)return;const o=u(e.value,e,!1).match(l);if(o){const{indent:n,content:i,leader:r}=o.groups;if(!i)return void(e.selectionStart=e.selectionStart-o[0].length);const s=`${n}${r}`;t.preventDefault(),h({tag:s,textArea:e,blockTag:"",wrap:!1,select:"",tagContent:""})}}(t,this),function(t,e){if(!gon.markdown_surround_selection)return;if(e.selectionStart===e.selectionEnd)return;const n={"*":"**{text}**",_:"_{text}_","`":"`{text}`","'":"'{text}'",'"':'"{text}"',"[":"[{text}]","{":"{{text}}","(":"({text})","<":"<{text}>"}[t.key];n&&(t.preventDefault(),h({tag:n,textArea:e,blockTag:"",wrap:!0,select:"",tagContent:""}))}(t,this)}function g(t){return h({textArea:t.closest(".md-area").find("textarea"),tag:t.data("mdTag"),cursorOffset:t.data("mdCursorOffset"),blockTag:t.data("mdBlock"),wrap:!t.data("mdPrepend"),select:t.data("mdSelect"),tagContent:t.attr("data-md-tag-content")})}function m(t){return i()(".markdown-area",t).on("keydown",p).each((function(){r.default.initMarkdownEditorShortcuts(i()(this),g)})),i()(".js-md",t).off("click").on("click",(function(){return g(i()(this))}))}function v(t){i()(".js-md").off("click").on("click",(function(e){const{mdTag:n,mdBlock:o,mdPrepend:r,mdSelect:s}=i()(e.currentTarget).data();f({tag:n,blockTag:o,wrap:!r,select:s,selected:t.getSelectedText(),text:t.getValue(),editor:t}),t.focus()}))}function x(t){return i()(".markdown-area",t).off("keydown",p).each((function(){r.default.removeMarkdownEditorShortcuts(i()(this))})),i()(".js-md",t).off("click")}},TOl7:function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return i}));n("AfGZ");e.a=function(t,e){const n=document.querySelector(t),o=document.querySelector(e);if(!n||!o)return;const i=n.closest("form");n.addEventListener("click",(function(){o.click()})),o.addEventListener("change",(function(){i.querySelector(".js-filename").textContent=o.value.replace(/^.*[\\\/]/,"")}))};const o=function(t){let e;return t&&(e=t.name),e},i=function(t){const e=t.name?t.name:"image.png";return/^[\w.\-+]+\.(png|jpg|jpeg|gif|bmp|tiff|ico|webp)$/.test(e)?e:"image.png"}},uY7R:function(t,e,n){"use strict";n.d(e,"a",(function(){return C}));var o=n("XtuB"),i=n("6oy4"),r=n.n(i),s=n("YI2X"),a=n("oj/M"),l=(n("AfGZ"),n("A1CF")),c=n.n(l),u=n("vP7+"),d=n.n(u),f=(n("QQrm"),n("TOl7")),h=n("vRHk"),p=n("t9l/");const g=function(t,e){return Math.max(...t.map((function(t){return t[e].length})))};class m{constructor(t){this.data=t,this.columnWidths=[],this.rows=[],this.tableFound=this.parseTable()}isTable(){return this.tableFound}convertToTableMarkdown(){var t=this;this.calculateColumnWidths();const e=this.rows.map((function(e){return`| ${e.map((function(e,n){return t.formatColumn(e,n)})).join(" | ")} |`}));return e.splice(1,0,this.generateHeaderBreak()),e.join("\n")}parseTable(){if(!this.data.types.includes("text/html")||!this.data.types.includes("text/plain"))return!1;const t=this.data.getData("text/html");if(this.doc=(new DOMParser).parseFromString(t,"text/html"),1!==this.doc.querySelectorAll("table:not(.diff-wrap-lines)").length)return!1;const e=this.data.getData("text/plain").trim().split(/[\n\u0085\u2028\u2029]|\r\n?/g);return this.doc.querySelectorAll("tr").length===e.length&&(this.rows=e.map((function(t){return t.split("\t")})),this.normalizeRows(),!!this.columnCountsMatch())}normalizeRows(){const t=this.rows.map((function(t){return t.length})),e=Math.max(...t);this.rows.forEach((function(t){for(;t.length<e;)t.push("")}))}calculateColumnWidths(){var t=this;this.columnWidths=this.rows[0].map((function(e,n){return g(t.rows,n)}))}columnCountsMatch(){const t=this.rows[0].length;let e=0;return this.doc.querySelectorAll("table tr").forEach((function(t){e=Math.max(t.cells.length,e)})),t===e}formatColumn(t,e){return t+Array(this.columnWidths[e]-t.length+1).join(" ")}generateHeaderBreak(){var t=this;return`|${this.columnWidths.map((function(e,n){return Array(t.columnWidths[n]+3).join("-")})).join("|")}|`}}var v=n("mphk"),x=n("AFSh");function w(t){return t&&"string"!=typeof t?t.message:t}function b(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{parallelUploads:2};const n=Object(a.Q)("paperclip","div-dropzone-icon s24"),o=t.find(".button-attach-file"),i=t.find(".attaching-file-message"),s=t.find(".button-cancel-uploading-files"),l=t.find(".retry-uploading-link"),u=t.find(".uploading-progress"),g=t.find(".uploading-error-container"),b=t.find(".uploading-error-message"),S=t.find(".uploading-progress-container"),C=t.data("uploads-path")||window.uploads_path||null,k=gon.max_file_size||10,y=t.find(".js-gfm-input");let z,j,A,E,O,T;y.wrap('<div class="div-dropzone"></div>'),y.on("paste",(function(t){return z(t)}));const D=y.closest(".md-area"),F=t.find(".div-dropzone");if(F.parent().addClass("div-dropzone-wrapper"),F.append('<div class="div-dropzone-hover"></div>'),F.find(".div-dropzone-hover").append(n),!C)return F.addClass("js-invalid-dropzone"),null;const $=F.dropzone({url:C,dictDefaultMessage:"",clickable:!0,paramName:"file",maxFilesize:k,uploadMultiple:!1,headers:x.a.headers,previewContainer:!1,...e,dragover:function(){D.addClass("is-dropzone-hover"),t.find(".div-dropzone-hover").css("opacity",.7)},dragleave:function(){D.removeClass("is-dropzone-hover"),t.find(".div-dropzone-hover").css("opacity",0)},drop:function(){D.removeClass("is-dropzone-hover"),t.find(".div-dropzone-hover").css("opacity",0),y.focus()},success(t,e){const n=this.getQueuedFiles().length+this.getUploadingFiles().length,i=n>=1;j(e.link.markdown,i),n||o.removeClass("hide"),A(e.link.url)},error:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(p.a)("Attaching the file failed."),n=arguments.length>2?arguments[2]:void 0;const i=w(e||n.responseText);g.removeClass("hide"),b.html(i),o.addClass("hide"),s.addClass("hide")},totaluploadprogress(t){E(this.files,i),u.text(`${Math.round(t)}%`)},sending:function(){o.addClass("hide"),g.addClass("hide"),S.removeClass("hide"),s.removeClass("hide")},removedfile:function(){o.removeClass("hide"),s.addClass("hide"),S.addClass("hide"),g.addClass("hide")},queuecomplete:function(){r()(".dz-preview").remove(),r()(".markdown-area").trigger("input"),S.addClass("hide"),s.addClass("hide")}}),M=r()($[0]).children("textarea");s.on("click",(function(t){t.preventDefault(),t.stopPropagation(),d.a.forElement(F.get(0)).removeAllFiles(!0)})),l.on("click",(function(t){const e=d.a.forElement(t.target.closest(".js-main-target-form").querySelector(".div-dropzone")),n=e.files;t.preventDefault(),e.removeAllFiles(!0),n.map((function(t){const n=t;return n.status===d.a.ERROR&&(n.status=void 0,n.accepted=void 0),e.addFile(n)}))})),z=function(t){const e=t.originalEvent,{clipboardData:n}=e;if(n&&n.items){const o=new m(n);if(o.isTable()){t.preventDefault();const e=o.convertToTableMarkdown();j(e)}else if(!T(e)){[...n.files].forEach((function(e){if(-1!==e.type.indexOf("image")){t.preventDefault();const n=246,o=Object(f.b)(e)||"image.png",i=Object(h.u)(o,n);j(`{{${i}}}`),O(e,i)}}))}}},T=function(t){return[...t.clipboardData.items].some((function(t){return"text/plain"===t.type}))},j=function(t,e){let n=t;e&&(n+="\n\n");const o=M.get(0),i=o.selectionStart,s=o.selectionEnd,a=r()(M).val().length,l=r()(M).val().substring(0,i),c=r()(M).val().substring(s,a);return r()(M).val(l+n+c),o.setSelectionRange(i+n.length,s+n.length),o.style.height=`${o.scrollHeight}px`,y.get(0).dispatchEvent(new Event("input")),y.trigger("input")},A=function(e){r()(t).append(`<input type="hidden" name="files[]" value="${c()(e)}">`)};const R=function(){return S.addClass("hide")};return O=function(t,e){const n=new FormData;n.append("file",t,e),S.removeClass("hide"),v.a.post(C,n).then((function(t){let{data:n}=t;const o=n.link.markdown;!function(t,e){const n=r()(M),o=n.get(0),i=o.selectionStart,s=o.selectionEnd,a=`{{${t}}}`;n.val((function(t,n){return n.replace(a,e)})),o.setSelectionRange(i-a.length+e.length,s-a.length+e.length),n.trigger("change")}(e,o),R()})).catch((function(t){var e;e=t.response.data.message,g.removeClass("hide"),b.html(e),R()}))},E=function(t,e){const n=t.filter((function(t){return"uploading"===t.status||"queued"===t.status})).length,o=Object(p.f)("Attaching a file","Attaching %d files",n);e.text(`${o} -`)},t.find(".markdown-selector").click((function(t){t.preventDefault(),r()(this).closest(".gfm-form").find(".div-dropzone").click(),y.focus()})),F.get(0)?d.a.forElement(F.get(0)):null}d.a.autoDiscover=!1;var S=n("Gapp");class C{constructor(t){var e=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.form=t,this.textarea=this.form.find("textarea.js-gfm-input"),this.enableGFM={...s.b,...n};const i=gl.GfmAutoComplete&&gl.GfmAutoComplete.dataSources||{};Object.keys(this.enableGFM).forEach((function(t){"emojis"===t||i[t]||(e.enableGFM[t]=!1)})),this.destroy(),this.setupForm(o),this.form.data("glForm",this)}destroy(){this.clearEventListeners(),this.autoComplete&&this.autoComplete.destroy(),this.formDropzone&&this.formDropzone.destroy(),this.form.data("glForm",null)}setupForm(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const e=this.form.is(":not(.gfm-form)")||t;this.form.removeClass("js-new-note-form"),e&&(this.form.find(".div-dropzone").remove(),this.form.addClass("gfm-form"),Object(a.k)(this.form.find(".js-note-text"),this.form.find(".js-comment-button, .js-note-new-discussion")),this.autoComplete=new s.a(gl.GfmAutoComplete&&gl.GfmAutoComplete.dataSources),this.autoComplete.setup(this.form.find(".js-gfm-input"),this.enableGFM),this.formDropzone=b(this.form,{parallelUploads:1}),Object(o.a)(this.textarea)),this.addEventListeners(),Object(S.b)(this.form),this.form.show(),this.isAutosizeable&&this.setupAutosize(),!0===this.textarea.data("autofocus")&&this.textarea.focus()}setupAutosize(){var t=this;this.textarea.off("autosize:resized").on("autosize:resized",this.setHeightData.bind(this)),this.textarea.off("mouseup.autosize").on("mouseup.autosize",this.destroyAutosize.bind(this)),setTimeout((function(){Object(o.a)(t.textarea),t.textarea.css("resize","vertical")}),0)}setHeightData(){this.textarea.data("height",this.textarea.outerHeight())}destroyAutosize(){const t=this.textarea.outerHeight();this.textarea.data("height")!==t&&(o.a.destroy(this.textarea),this.textarea.data("height",t),this.textarea.outerHeight(t),this.textarea.css("max-height",window.outerHeight))}clearEventListeners(){this.textarea.off("focus"),this.textarea.off("blur"),Object(S.c)(this.form)}addEventListeners(){this.textarea.on("focus",(function(){r()(this).closest(".md-area").addClass("is-focused")})),this.textarea.on("blur",(function(){r()(this).closest(".md-area").removeClass("is-focused")}))}get supportsQuickActions(){return Boolean(this.textarea.data("supports-quick-actions"))}}}}]);
//# sourceMappingURL=commons-pages.admin.topics.edit-pages.admin.topics.new-pages.groups.epics.new-pages.groups.epics.sho-59a8e774.9fc6fd37.chunk.js.map