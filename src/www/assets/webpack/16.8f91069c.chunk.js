(this.webpackJsonp=this.webpackJsonp||[]).push([[16],{ZRbW:function(e,t,a){var n=a("Iwy8"),s=a("/e4I");e.exports=function(e,t){return e&&e.length?s(e,n(t,2)):[]}},r5Uk:function(e,t,a){"use strict";a.r(t);a("AfGZ");var n=a("ZRbW"),s=a.n(n),r=a("lb6a"),i=a.n(r),l=a("A1CF"),o=a.n(l),u=a("6oy4"),d=a.n(u);const c={projectId:"projectId",groupId:"groupId",showCurrentUser:"currentUser",authorId:"authorId",skipUsers:"skipUsers",samlProviderId:"samlProviderId"},f={project_id:"projectId",group_id:"groupId",skip_ldap:"skipLdap",todo_filter:"todoFilter",todo_state_filter:"todoStateFilter",current_user:"showCurrentUser",author_id:"authorId",skip_users:"skipUsers",saml_provider_id:"samlProviderId"};var m=a("rl6E"),p=a("Daar"),h=a("16BQ"),g=a("mphk"),v=a("oj/M"),b=a("e+le"),j=a("t9l/");const w=function(e,t){return Object.keys(t).reduce((function(a,n){const s=t[n];return a[n]=e.data(s),a}),{})},_=function(e,t){return Object.keys(t).reduce((function(a,n){const s=t[n];return a[n]=e[s]||null,a}),{})};function y(e,t){var n=this;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const l=null==t?void 0:t.toString().match(".(.+$)")[1],u=d()(t||".js-user-search");this.users=this.users.bind(this),this.user=this.user.bind(this),this.usersPath="/-/autocomplete/users.json",this.userPath="/-/autocomplete/users/:id.json",null!=e&&(this.currentUser="object"==typeof e?e:JSON.parse(e));const{handleClick:f}=r,p=this;u.each((function(e,t){const a=n,r={},u=d()(t);r.projectId=u.data("projectId"),r.groupId=u.data("groupId"),r.showCurrentUser=u.data("currentUser"),r.todoFilter=u.data("todoFilter"),r.todoStateFilter=u.data("todoStateFilter"),r.iid=u.data("iid"),r.issuableType=u.data("issuableType"),r.targetBranch=u.data("targetBranch");const c=u.data("nullUser"),p=u.data("nullUserDefault"),b=u.data("showMenuAbove"),w=u.data("anyUser"),_=u.data("firstUser");r.authorId=u.data("authorId");const y=u.data("defaultLabel"),U=u.data("issueUpdate"),S=u.closest(".selectbox"),$=S.next(".assign-to-me-link");let C=S.closest(".block");const O=u.data("abilityName");let x=C.find(".value");const k=C.find(".sidebar-collapsed-user"),I=C.find(".block-loading").addClass("gl-display-none"),A=p&&c?0:null;let N,R,D,E=u.data("selected");void 0===E&&(E=A);const T=function(){const e=u.closest(".selectbox").find(`input[name='${u.data("fieldName")}'][value=0]`);e&&e.remove();const t=u.data("currentUserInfo")||{},n=a.currentUser||{},s=u.data("fieldName"),r=t.name,l=t.id||n.id,o=i()('\n        <input type="hidden" name="<%- fieldName %>"\n          data-meta="<%- userName %>"\n          value="<%- userId %>" />\n        ')({fieldName:s,userName:r,userId:l});S?u.parent().before(o):u.after(o)};C[0]&&C[0].addEventListener("assignYourself",T);const L=function(){return S.find(`input[name="${u.data("fieldName")}"]`)},M=function(){return L().map((function(e,t){return parseInt(t.value,10)})).get()},F=function(){const e=u.data("maxSelect");if(e){const t=M();if(t.length>e){const e=t[0];u.closest(".selectbox").find(`input[name='${u.data("fieldName")}'][value=${e}]`).remove(),u.hasClass(l)?emitSidebarEvent("sidebar.removeReviewer",{id:e}):emitSidebarEvent("sidebar.removeAssignee",{id:e})}}},B=function(e,t){const a=M().filter((function(e){return 0!==e})),n=L().map((function(e,t){return{name:t.dataset.meta,value:parseInt(t.value,10)}})).filter((function(e){return 0!==e.id})).get(0);if(0===a.length)return Object(j.g)("UsersSelect|Unassigned");if(1===a.length)return n.name;if(t){const t=a.filter((function(t){return t!==e.id}));return Object(j.h)(Object(j.g)("UsersSelect|%{name} + %{length} more"),{name:e.name,length:t.length})}return Object(j.h)(Object(j.g)("UsersSelect|%{name} + %{length} more"),{name:n.name,length:a.length-1})};return $.on("click",(function(e){if(e.preventDefault(),d()(e.currentTarget).hide(),u.data("multiSelect")){T(),F();const e=u.data("currentUserInfo");u.find(".dropdown-toggle-text").text(B(e)).removeClass("is-default")}else{const e=d()(`input[name="${u.data("fieldName")}"]`);e.val(gon.current_user_id),E=e.val(),u.find(".dropdown-toggle-text").text(gon.current_user_fullname).removeClass("is-default")}})),C.on("click",".js-assign-yourself",(function(e){return e.preventDefault(),N(a.currentUser.id)})),N=function(e){const t={};return t[O]={},t[O].assignee_id=null!=e?e:null,I.removeClass("gl-display-none"),u.trigger("loading.gl.dropdown"),g.a.put(U,t).then((function(e){let{data:t}=e,a={},n=a.name;return u.trigger("loaded.gl.dropdown"),I.addClass("gl-display-none"),t.assignee?(a={name:t.assignee.name,username:t.assignee.username,avatar:t.assignee.avatar_url},n=o()(a.name)):(a={name:Object(j.g)("UsersSelect|Unassigned"),username:"",avatar:""},n=Object(j.g)("UsersSelect|Assignee")),x.html(R(a)),k.attr("title",n),Object(h.c)(k),k.html(D(a))}))},D=i()(`<% if( avatar ) { %> <a class="author-link" href="/<%- username %>"> <img width="24" class="avatar avatar-inline s24" alt="" src="<%- avatar %>"> </a> <% } else { %> ${Object(v.Q)("user")} <% } %>`),R=i()(`<% if (username) { %> <a class="author-link bold" href="/<%- username %>"> <% if( avatar ) { %> <img width="32" class="avatar avatar-inline s32" alt="" src="<%- avatar %>"> <% } %> <span class="author"><%- name %></span> <span class="username"> @<%- username %> </span> </a> <% } else { %> <span class="no-value assign-yourself">\n      ${Object(j.h)(Object(j.g)("UsersSelect|No assignee - %{openingTag} assign yourself %{closingTag}"),{openingTag:'<a href="#" class="js-assign-yourself">',closingTag:"</a>"})}</span> <% } %>`),Object(m.a)(u,{showMenuAbove:b,data(e,t){var n=this;return a.users(e,r,(function(a){(n.instance||n.options.instance).options.processData(e,a,t)}))},processData(e,t,a){const n=t.filter((function(e){return!e.type}));let r,i,l,o,d,f,m=n;if(u.hasClass("js-multiselect")&&0===e.length){const e=L(),t=s()(e,(function(e){return e.value})).filter((function(e){const t=parseInt(e.value,10);return!m.find((function(e){return e.id===t}))&&0!==t})).map((function(e){const t=parseInt(e.value,10),{avatarUrl:a,avatar_url:n,name:s,username:r,canMerge:i}=e.dataset;return{avatar_url:a||n||gon.default_avatar_url,id:t,name:s,username:r,can_merge:Object(v.E)(i)}}));m=n.concat(t)}if(0===e.length){if(f=0,_)for(i=0,l=m.length;i<l;i+=1)if((d=m[i]).username===_){m.splice(i,1),m.unshift(d);break}if(c&&(f+=1,m.unshift({beforeDivider:!0,name:Object(j.g)("UsersSelect|Unassigned"),id:0})),w&&(f+=1,!0===(o=w)&&(o=Object(j.g)("UsersSelect|Any User")),r={beforeDivider:!0,name:o,id:null},m.unshift(r)),f&&m.splice(f,0,{type:"divider"}),u.hasClass("js-multiselect")){const e=M().filter((function(e){return 0!==e}));if(e.length>0){u.data("dropdownHeader")&&(f+=1,m.splice(f,0,{type:"header",content:u.data("dropdownHeader")}));const t=m.filter((function(t){return-1!==e.indexOf(t.id)})).sort((function(e,t){return e.name>t.name}));m=m.filter((function(t){return-1===e.indexOf(t.id)})),t.forEach((function(e){f+=1,m.splice(f,0,e)})),m.splice(f+1,0,{type:"divider"})}}}a(m),b&&u.data("deprecatedJQueryDropdown").positionMenuAbove()},filterable:!0,filterRemote:!0,search:{fields:["name","username"]},selectable:!0,fieldName:u.data("fieldName"),toggleLabel(e,t,a){const n=a.filterInput.val();if(this.multiSelect&&""===n){const e=a.filteredFullData(),t=a.parseData.bind(a);this.processData(n,e,t)}return this.multiSelect?B(e,d()(t).hasClass("is-active")):e&&"id"in e&&d()(t).hasClass("is-active")?(u.find(".dropdown-toggle-text").removeClass("is-default"),e.text?e.text:e.name):(u.find(".dropdown-toggle-text").addClass("is-default"),y)},defaultLabel:y,hidden(){u.hasClass("js-multiselect")&&(u.hasClass(l)?emitSidebarEvent("sidebar.saveReviewers"):emitSidebarEvent("sidebar.saveAssignees")),u.data("alwaysShowSelectbox")||(S.hide(),C=S.closest(".block"),(x=C.find(".value")).css("display",""))},multiSelect:u.hasClass("js-multiselect"),inputMeta:u.data("inputMeta"),clicked(e){const{$el:t,e:a,isMarking:n}=e,s=e.selectedObj;if(Object(h.b)(t),u.hasClass("js-multiselect")){const e=t.hasClass("is-active"),a=u.closest(".selectbox").find(`input[name='${u.data("fieldName")}'][value!=0]`);if(F(),s.beforeDivider&&"unassigned"===s.name.toLowerCase())a.each((function(e,t){t.remove()})),u.hasClass(l)?emitSidebarEvent("sidebar.removeAllReviewers"):emitSidebarEvent("sidebar.removeAllAssignees");else if(e){u.hasClass(l)?emitSidebarEvent("sidebar.addReviewer",s):emitSidebarEvent("sidebar.addAssignee",s);const e=u.closest(".selectbox").find(`input[name='${u.data("fieldName")}'][value=0]`);e&&e.remove()}else 0===a.length&&this.addInput(u.data("fieldName"),0,{}),u.hasClass(l)?emitSidebarEvent("sidebar.removeReviewer",s):emitSidebarEvent("sidebar.removeAssignee",s);M().find((function(e){return e===gon.current_user_id}))?$.hide():$.show()}const r=d()("body").attr("data-page"),i="projects:issues:index"===r,o=r==r&&"projects:merge_requests:index"===r;if(u.hasClass("js-filter-bulk-update")||u.hasClass("js-issuable-form-dropdown")){a.preventDefault();const e=s.id!==E;(E=e?s.id:A)===gon.current_user_id?d()(".assign-to-me-link").hide():d()(".assign-to-me-link").show()}else{if(f)a.preventDefault(),f(s,n);else{if(u.hasClass("js-filter-submit")&&(i||o))return Issuable.filterResults(u.closest("form"));if(u.hasClass("js-filter-submit"))return u.closest("form").submit();if(!u.hasClass("js-multiselect")){const e=u.closest(".selectbox").find(`input[name='${u.data("fieldName")}']`).val();return N(e)}}u.data("maxSelect")&&M().length===u.data("maxSelect")&&u.dropdown("toggle")}},id:e=>e.id,opened(e){const t=d()(e.currentTarget),a=M();function n(e){t.find(`li[data-user-id="${e}"] .dropdown-menu-user-link`).addClass("is-active")}t.find(".is-active").removeClass("is-active"),a.length>0?M().forEach((function(e){return n(e)})):n(E)},updateLabel:u.data("dropdownTitle"),renderRow(e){const t=e.username?`@${e.username}`:"",n=e.avatar_url?e.avatar_url:gon.default_avatar_url;let s=!1;if(this.multiSelect){s=M().find((function(t){return e.id===t}));const{fieldName:t}=this;u.closest(".selectbox").find(`input[name='${t}'][value='${e.id}']`).length&&(s=!0)}else s=e.id===E;let i="";return null!=e.beforeDivider?o()(e.name):i=`<img src='${n}' class='avatar avatar-inline m-0' width='32' />`,a.renderRow(r.issuableType,e,s,t,i,l)}})})),d()(".ajax-users-select").length&&a.e(871).then(a.t.bind(null,"adUV",7)).then((function(){Object(b.a)(gon.select2_css_path).then((function(){d()(".ajax-users-select").each((function(e,t){const a=w(d()(t),c);a.skipLdap=d()(t).hasClass("skip_ldap");const n=d()(t).data("nullUser"),s=d()(t).data("anyUser"),r=d()(t).data("emailUser"),i=d()(t).data("firstUser");return d()(t).select2({placeholder:Object(j.a)("Search for a user"),multiple:d()(t).hasClass("multiselect"),minimumInputLength:0,query:e=>p.users(e.term,a,(function(t){let a;const l={results:t};if(0===e.term.length){if(i){const e=l.results;for(let t=0,a=e.length;t<a;t+=1){const a=e[t];if(a.username===i){l.results.splice(t,1),l.results.unshift(a);break}}}if(n){const e={name:Object(j.g)("UsersSelect|Unassigned"),id:0};l.results.unshift(e)}if(s){!0===(a=s)&&(a=Object(j.g)("UsersSelect|Any User"));const e={name:a,id:null};l.results.unshift(e)}}if(r&&0===l.results.length&&e.term.match(/^[^@]+@[^@]+$/)){const t=e.term.trim(),a={name:Object(j.h)(Object(j.a)('Invite "%{trimmed}" by email'),{trimmed:t}),username:t,id:t,invite:!0};l.results.unshift(a)}return e.callback(l)})),initSelection(){const e=1<=arguments.length?[].slice.call(arguments,0):[];return p.initSelection.apply(p,e)},formatResult(){const e=1<=arguments.length?[].slice.call(arguments,0):[];return p.formatResult.apply(p,e)},formatSelection(){const e=1<=arguments.length?[].slice.call(arguments,0):[];return p.formatSelection.apply(p,e)},dropdownCssClass:"ajax-users-dropdown",escapeMarkup:e=>e})}))})).catch((function(){}))})).catch((function(){}))}window.emitSidebarEvent=window.emitSidebarEvent||d.a.noop,y.prototype.initSelection=function(e,t){const a=d()(e).val();if("0"===a){return t({name:Object(j.g)("UsersSelect|Unassigned")})}if(""!==a)return this.user(a,t)},y.prototype.formatResult=function(e){let t=gon.default_avatar_url;return e.avatar_url&&(t=e.avatar_url),`\n    <div class='user-result'>\n      <div class='user-image'>\n        <img class='avatar avatar-inline s32' src='${t}'>\n      </div>\n      <div class='user-info'>\n        <div class='user-name dropdown-menu-user-full-name'>\n          ${o()(e.name)}\n        </div>\n        <div class='user-username dropdown-menu-user-username text-secondary'>\n          ${e.invite?"":`@${o()(e.username)}`}\n        </div>\n      </div>\n    </div>\n  `},y.prototype.formatSelection=function(e){return o()(e.name)},y.prototype.user=function(e,t){if(!/^\d+$/.test(e))return!1;let a=this.buildUrl(this.userPath);return a=a.replace(":id",e),g.a.get(a).then((function(e){let{data:a}=e;t(a)}))},y.prototype.users=function(e,t,a){const n=this.buildUrl(this.usersPath),s={search:e,active:!0,..._(t,f)},r="merge_request"===t.issuableType,i=!t.issuableType&&t.iid&&t.targetBranch,l=!t.issuableType&&!t.iid&&t.targetBranch;return(r||i||l)&&(s.merge_request_iid=t.iid||null,s.approval_rules=!0),l&&(s.target_branch=t.targetBranch||null),g.a.get(n,{params:s}).then((function(e){let{data:t}=e;a(t)}))},y.prototype.buildUrl=function(e){return null!=gon.relative_url_root&&(e=gon.relative_url_root.replace(/\/$/,"")+e),e},y.prototype.renderRow=function(e,t,a,n,s,r){const i="merge_request"!==e||t.can_merge?"":Object(j.a)("Cannot merge"),l=`${!0===a?"is-active":""} ${i?"has-tooltip":""}`,u=i?`data-container="body" data-placement="left" data-title="${i}"`:"",d=null!=t&&t.availability&&Object(p.a)(t.availability)?Object(j.h)(Object(j.a)("%{name} (Busy)"),{name:t.name}):t.name;return`\n    <li data-user-id=${t.id}>\n      <a href="#" class="dropdown-menu-user-link d-flex align-items-center ${l}" ${u}>\n        ${this.renderRowAvatar(e,t,s)}\n        <span class="d-flex flex-column overflow-hidden">\n          <strong class="dropdown-menu-user-full-name gl-font-weight-bold">\n            ${o()(d)}\n          </strong>\n          ${n?`<span class="dropdown-menu-user-username gl-text-gray-400">${n}</span>`:""}\n          ${this.renderApprovalRules(r,t.applicable_approval_rules)}\n        </span>\n      </a>\n    </li>\n  `},y.prototype.renderRowAvatar=function(e,t,a){if(t.beforeDivider)return a;return`<span class="position-relative mr-2">\n    ${a}\n    ${"merge_request"!==e||t.can_merge?"":Object(v.Q)("warning-solid","s12 merge-icon")}\n  </span>`},y.prototype.renderApprovalRules=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const a=t.length;if(null==e||!e.includes("reviewer")||!a)return"";const[n]=t,s=Object(j.h)(Object(j.a)("(+%{count}&nbsp;rules)"),{count:a}),r=a>1?`<span class="ml-1">${s}</span>`:"",i="code_owner"===n.rule_type?Object(j.a)("Code Owner"):o()(n.name);return`<div class="gl-display-flex gl-font-sm">\n    <span class="gl-text-truncate" title="${i}">${i}</span>\n    ${r}\n  </div>`};t.default=y}}]);
//# sourceMappingURL=16.8f91069c.chunk.js.map